<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canadian Tax Impact Calculator</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Set up custom font and configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary-blue': '#1e40af',
                        'secondary-green': '#059669',
                        'negative-red': '#dc2626',
                        'card-bg': '#f3f4f6',
                        'detail-bg': '#e0f2f1', /* Light teal for breakdown */
                        'deduction-bg': '#fee2e2', /* Light red for deductions */
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom styles for appearance */
        body {
            background-color: #e5e7eb;
            font-family: 'Inter', sans-serif;
        }
        .input-field {
            @apply w-full p-3 border border-gray-300 rounded-lg focus:ring-primary-blue focus:border-primary-blue transition duration-150;
        }
        .breakdown-step {
            @apply flex justify-between items-center py-2 px-3 border-b border-gray-200 text-sm;
        }
        .breakdown-section-title {
            @apply font-bold text-base mt-3 mb-1 px-3 py-1 rounded-md text-gray-800;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl bg-white shadow-2xl rounded-xl p-8 space-y-8">
        <h1 class="text-3xl font-bold text-center text-primary-blue border-b pb-4">
            Investment Tax Impact Calculator (CAD)
        </h1>

        <div class="text-sm text-gray-600 space-y-1">
            <p>This tool calculates the combined tax effect of capital gains (50% taxable), interest income (100% taxable), margin interest deductions, and RRSP contributions based on Canadian tax rules.</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Input 1: Capital Gain -->
            <div>
                <label for="capitalGain" class="block text-sm font-medium text-gray-700 mb-1">Total Capital Gain ($)</label>
                <input type="number" id="capitalGain" value="60000" class="input-field" placeholder="e.g., 60000">
            </div>

            <!-- Input 2: Interest Income -->
            <div>
                <label for="interestIncome" class="block text-sm font-medium text-gray-700 mb-1">Interest Income ($)</label>
                <input type="number" id="interestIncome" value="10000" class="input-field" placeholder="e.g., 10000">
            </div>

            <!-- Input 3: Margin Interest Deduction -->
            <div>
                <label for="marginInterest" class="block text-sm font-medium text-gray-700 mb-1">Margin Interest Deduction ($)</label>
                <input type="number" id="marginInterest" value="13200" class="input-field" placeholder="e.g., 13200">
            </div>

            <!-- Input 4: RRSP Contribution -->
            <div>
                <label for="rrspContribution" class="block text-sm font-medium text-gray-700 mb-1">RRSP Contribution ($)</label>
                <input type="number" id="rrspContribution" value="30000" class="input-field" placeholder="e.g., 30000">
            </div>

            <!-- Input 5: Marginal Tax Rate -->
            <div class="md:col-span-2">
                <label for="marginalRate" class="block text-sm font-medium text-gray-700 mb-1">Marginal Tax Rate (%)</label>
                <input type="number" id="marginalRate" value="50" class="input-field" placeholder="e.g., 50">
            </div>
        </div>

        <button onclick="calculateTaxImpact()"
                class="w-full bg-secondary-green hover:bg-emerald-700 text-white font-semibold py-3 rounded-lg shadow-lg transition duration-200 transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-emerald-500 focus:ring-opacity-50">
            Calculate Tax Impact
        </button>

        <!-- Results Section -->
        <div id="results" class="space-y-6 pt-4 border-t border-gray-200 hidden">

            <h2 class="text-xl font-semibold text-primary-blue">Calculation Breakdown</h2>

            <!-- Detailed Breakdown Container -->
            <div id="calculationBreakdown" class="bg-card-bg rounded-lg p-3 shadow-inner">
                <!-- Content generated by JavaScript -->
            </div>


            <!-- Net Change in Taxable Income -->
            <div class="p-4 bg-gray-200 rounded-lg flex justify-between items-center shadow-lg">
                <span class="font-bold text-gray-700">Net Change in Taxable Income (NCITI):</span>
                <span id="netTaxableIncome" class="text-xl font-extrabold text-gray-900"></span>
            </div>

            <!-- Final Tax Payable Change -->
            <div class="p-4 rounded-lg flex justify-between items-center shadow-lg" id="taxPayableContainer">
                <span class="font-medium text-white" id="taxPayableLabel">Final Tax Payable Change:</span>
                <span id="taxPayableChange" class="text-2xl font-extrabold text-white"></span>
            </div>

            <p id="taxPayableStatus" class="text-center font-semibold"></p>

        </div>
    </div>

    <script>
        // Use a simple number formatter for currency display
        const currencyFormatter = new Intl.NumberFormat('en-CA', {
            style: 'currency',
            currency: 'CAD',
            minimumFractionDigits: 0,
            maximumFractionDigits: 0
        });

        // Function to handle the tax calculation
        function calculateTaxImpact() {
            // 1. Get and clean input values
            const capitalGain     = parseFloat(document.getElementById('capitalGain').value) || 0;
            const interestIncome  = parseFloat(document.getElementById('interestIncome').value) || 0;
            const marginInterest  = parseFloat(document.getElementById('marginInterest').value) || 0;
            const rrspContribution= parseFloat(document.getElementById('rrspContribution').value) || 0;
            const marginalRate    = parseFloat(document.getElementById('marginalRate').value) / 100 || 0;

            // Simple validation
            if (marginalRate === 0) {
                document.getElementById('netTaxableIncome').textContent = "Error";
                document.getElementById('taxPayableChange').textContent = "Rate Required";
                document.getElementById('results').classList.remove('hidden');
                document.getElementById('taxPayableContainer').className = 'p-4 rounded-lg flex justify-between items-center shadow-lg bg-negative-red';
                document.getElementById('taxPayableStatus').textContent = "";
                return;
            }

            // --- 2. Calculation Logic ---

            // A. Calculate Inclusions (Taxable Income Added)
            const taxableGain = capitalGain * 0.50; // Capital Gains inclusion rate is 50%
            const taxableInterest = interestIncome * 1.00; // Interest Income inclusion rate is 100%

            const totalInclusions = taxableGain + taxableInterest; // e.g., 30,000 + 10,000 = 40,000

            // B. Calculate Deductions (Taxable Income Reduced)
            const totalDeductions = marginInterest + rrspContribution; // e.g., 13,200 + 30,000 = 43,200

            // C. Net Change in Taxable Income (NCITI)
            const netChangeInTaxableIncome = totalInclusions - totalDeductions; // e.g., 40,000 - 43,200 = -3,200

            // D. Tax Payable Change (TPC)
            const taxPayableChange = netChangeInTaxableIncome * marginalRate; // e.g., -3,200 * 0.50 = -1,600

            // --- 3. Display Results ---
            const resultsDiv = document.getElementById('results');
            const netIncomeElement = document.getElementById('netTaxableIncome');
            const taxPayableElement = document.getElementById('taxPayableChange');
            const taxPayableContainer = document.getElementById('taxPayableContainer');
            const taxPayableStatus = document.getElementById('taxPayableStatus');
            const breakdownDiv = document.getElementById('calculationBreakdown');

            // --- Generate Detailed Breakdown HTML ---
            const breakdownHTML = `
                <div class="breakdown-section-title bg-detail-bg">Taxable Inclusions (Income Added)</div>
                <div class="breakdown-step">
                    <span>Capital Gain (${currencyFormatter.format(capitalGain)} &times; 50%):</span>
                    <span class="font-semibold text-secondary-green">${currencyFormatter.format(taxableGain)}</span>
                </div>
                <div class="breakdown-step">
                    <span>Interest Income (${currencyFormatter.format(interestIncome)} &times; 100%):</span>
                    <span class="font-semibold text-secondary-green">${currencyFormatter.format(taxableInterest)}</span>
                </div>
                <div class="breakdown-step font-bold border-t-2 border-primary-blue bg-gray-100">
                    <span>A. Total Taxable Inclusions:</span>
                    <span class="text-lg text-secondary-green">${currencyFormatter.format(totalInclusions)}</span>
                </div>

                <div class="breakdown-section-title bg-deduction-bg">Tax Deductions (Income Reduced)</div>
                <div class="breakdown-step">
                    <span>Margin Interest Deduction:</span>
                    <span class="font-semibold text-negative-red">-${currencyFormatter.format(marginInterest)}</span>
                </div>
                <div class="breakdown-step">
                    <span>RRSP Contribution Deduction:</span>
                    <span class="font-semibold text-negative-red">-${currencyFormatter.format(rrspContribution)}</span>
                </div>
                <div class="breakdown-step font-bold border-t-2 border-primary-blue bg-gray-100">
                    <span>B. Total Deductions:</span>
                    <span class="text-lg text-negative-red">-${currencyFormatter.format(totalDeductions)}</span>
                </div>

                <div class="breakdown-section-title bg-primary-blue text-white">Net Change in Taxable Income (A - B)</div>
                <div class="breakdown-step font-bold text-lg">
                    <span>Net Change: ${currencyFormatter.format(totalInclusions)} - ${currencyFormatter.format(totalDeductions)}</span>
                    <span class="text-2xl text-primary-blue">${currencyFormatter.format(netChangeInTaxableIncome)}</span>
                </div>
                <div class="breakdown-step text-sm italic text-gray-600">
                    This change is multiplied by your Marginal Rate (${(marginalRate * 100).toFixed(0)}%) to find the final tax impact.
                </div>
            `;
            
            breakdownDiv.innerHTML = breakdownHTML;

            // --- Display Final Result ---

            // Format NCITI display
            netIncomeElement.textContent = currencyFormatter.format(netChangeInTaxableIncome);

            // Determine display color and status message based on TPC sign
            if (taxPayableChange < 0) {
                // Tax payable is reduced (good outcome)
                taxPayableContainer.className = 'p-4 rounded-lg flex justify-between items-center shadow-lg bg-secondary-green';
                taxPayableElement.textContent = currencyFormatter.format(Math.abs(taxPayableChange));
                taxPayableStatus.className = 'text-lg text-secondary-green';
                taxPayableStatus.textContent = "Overall, this results in a reduction of your total tax payable (Tax Refund/Saving).";
                document.getElementById('taxPayableLabel').textContent = "Tax Reduction / Saving:";
            } else if (taxPayableChange > 0) {
                // Tax payable is increased (tax due)
                taxPayableContainer.className = 'p-4 rounded-lg flex justify-between items-center shadow-lg bg-negative-red';
                taxableElement.textContent = currencyFormatter.format(taxPayableChange);
                taxPayableStatus.className = 'text-lg text-negative-red';
                taxPayableStatus.textContent = "Overall, this results in an increase to your total tax payable (Tax Due).";
                document.getElementById('taxPayableLabel').textContent = "Additional Tax Due:";
            } else {
                // Net zero change
                taxPayableContainer.className = 'p-4 rounded-lg flex justify-between items-center shadow-lg bg-gray-500';
                taxPayableElement.textContent = currencyFormatter.format(0);
                taxPayableStatus.className = 'text-lg text-gray-700';
                taxPayableStatus.textContent = "These transactions result in a net zero change to your tax payable.";
                document.getElementById('taxPayableLabel').textContent = "Final Tax Payable Change:";
            }

            // Make the results visible
            resultsDiv.classList.remove('hidden');
        }

        // Run the calculation once on load with default values
        window.onload = calculateTaxImpact;
    </script>
</body>
</html>